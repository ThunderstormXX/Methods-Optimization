# ‚öôÔ∏è –§—Ä–µ–π–º–≤–æ—Ä–∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è PyTorch

–ú–∏–Ω–∏-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* **–ì–∏–±–∫–∞—è –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ª–µ–≥–∫–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏, –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä—ã
* **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã:** Frank‚ÄìWolfe, Projected Gradient, N-Conjugate Frank‚ÄìWolfe
* **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤:** L‚ÇÅ, L‚ÇÇ –∏ L‚àû-–Ω–æ—Ä–º—ã
* **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ `torch.nn.Module`
* **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:** —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–Ω–æ–∂–µ—Å—Ç–≤ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–æ–≤

---

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
constraint_optimization/
‚îú‚îÄ‚îÄ example_all_constraints.py   # –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ small_cnn.py             # –ü—Ä–æ—Å—Ç–∞—è CNN –¥–ª—è MNIST
‚îú‚îÄ‚îÄ sets/
‚îÇ   ‚îú‚îÄ‚îÄ base.py                  # –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å ConstraintSet
‚îÇ   ‚îú‚îÄ‚îÄ l1_constraint.py         # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ L‚ÇÅ-–Ω–æ—Ä–º–µ
‚îÇ   ‚îú‚îÄ‚îÄ l2_constraint.py         # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ L‚ÇÇ-–Ω–æ—Ä–º–µ
‚îÇ   ‚îî‚îÄ‚îÄ linf_constraint.py       # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ L‚àû-–Ω–æ—Ä–º–µ
‚îî‚îÄ‚îÄ optim/
    ‚îú‚îÄ‚îÄ frank_wolfe.py           # –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä Frank‚ÄìWolfe
    ‚îú‚îÄ‚îÄ projected_grad.py        # –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä Projected Gradient
    ‚îî‚îÄ‚îÄ n_conjugate_frank_wolfe.py  # N-Conjugate Frank‚ÄìWolfe
```

---

## üöÄ –ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install torch torchvision matplotlib tqdm scipy
```

### 2. –ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

```bash
python constraint_optimization/example_all_constraints.py
```

–°–∫—Ä–∏–ø—Ç:

1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç MNIST (2000 –ø—Ä–∏–º–µ—Ä–æ–≤)
2. –û–±—É—á–∞–µ—Ç CNN —Å 9 –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º–∏ (FW, PG, NFW √ó L‚ÇÅ, L‚ÇÇ, L‚àû)
3. –°—Ç—Ä–æ–∏—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤:

```
comparison_L1.png
comparison_L2.png
comparison_Linf.png
comparison_all.png
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

–ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã –≥—Ä–∞—Ñ–∏–∫–∏ —É–±—ã–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–Ω–æ–∂–µ—Å—Ç–≤:

### üîπ L‚ÇÅ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

<p align="center">
  <img src="../comparison_L1.png" alt="L1-constraint comparison" width="600"/>
</p>

### üîπ L‚ÇÇ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

<p align="center">
  <img src="../comparison_L2.png" alt="L2-constraint comparison" width="600"/>
</p>

### üîπ L‚àû-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

<p align="center">
  <img src="../comparison_Linf.png" alt="Linf-constraint comparison" width="600"/>
</p>

‚úÖ **Projected Gradient** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–≥—É—é –ø—Ä–æ–µ–∫—Ü–∏—é –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ.
‚öôÔ∏è **Frank‚ÄìWolfe** –∏ **N-Conjugate FW** –Ω–µ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–µ–∫—Ü–∏–π, –Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å LMO (Linear Minimization Oracle).
üß© **NFW** —É—Å–∫–æ—Ä—è–µ—Ç —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å –∑–∞ —Å—á—ë—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏ –∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏–∏ –∫—Ä–∏–≤–∏–∑–Ω—ã.

---

–û—Ç–ª–∏—á–Ω–æ üëå ‚Äî —Ç–æ–≥–¥–∞ –≤ README –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ
–≤—Å–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è **–≤ —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–æ–π –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–µ**,
—Ç–æ –µ—Å—Ç—å –Ω–∞ –º–∏–Ω–∏-–±–∞—Ç—á–∞—Ö (SGD-—Ä–µ–∂–∏–º), –∞ –Ω–µ –Ω–∞ –ø–æ–ª–Ω–æ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–µ.

–ù–∏–∂–µ —è –æ–±–Ω–æ–≤–∏–ª —Ä–∞–∑–¥–µ–ª —Å —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å—é –∏ –¥–æ–±–∞–≤–∏–ª –Ω–µ–±–æ–ª—å—à–æ–π –ø–æ—è—Å–Ω—è—é—â–∏–π –±–ª–æ–∫
**¬´–°—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞¬ª**, —á—Ç–æ–±—ã —ç—Ç–æ –≤—ã–≥–ª—è–¥–µ–ª–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ —Å –∫–æ–¥–æ–º.

---

## üìà –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å

### üîπ –°—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞

–í–æ –≤—Å–µ—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞—Ö –º–µ—Ç–æ–¥—ã Frank‚ÄìWolfe, Projected Gradient –∏ N-Conjugate FW
–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ **—Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ**, –≥–¥–µ –Ω–∞ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç
–æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –ø–æ —Å–ª—É—á–∞–π–Ω–æ–º—É –º–∏–Ω–∏-–±–∞—Ç—á—É –¥–∞–Ω–Ω—ã—Ö.

–ü—É—Å—Ç—å

```math
g_t = \nabla f_{B_t}(x_t)
```

‚Äî —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –Ω–∞ –±–∞—Ç—á–µ `B_t`.
–¢–æ–≥–¥–∞ –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ–º—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é:

* **PGD:**

  ```math
  x_{t+1} = \Pi_{\mathcal{C}}(x_t - \eta_t g_t)
  ```
* **FW:**

  ```math
  s_t = \arg\min_{s \in \mathcal{C}} \langle g_t, s \rangle, 
  \qquad
  x_{t+1} = (1 - \gamma_t)x_t + \gamma_t s_t
  ```

–¢–∞–∫–∞—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—ë—Ç –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ
–∏ –¥–µ–ª–∞–µ—Ç –º–µ—Ç–æ–¥—ã –ø—Ä–∏–≥–æ–¥–Ω—ã–º–∏ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π.

---

### üîπ Projected Gradient Descent (PGD)

```math
x_{t+1} = \Pi_{\mathcal{C}}(x_t - \eta_t \nabla f(x_t))
```

**–°—Ö–æ–¥–∏–º–æ—Å—Ç—å (–æ–∂–∏–¥–∞–µ–º–∞—è):**

* –î–ª—è –≤—ã–ø—É–∫–ª–æ–π –∏ L-–≥–ª–∞–¥–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ *f*:

  ```math
  \mathbb{E}[f(x_t)] - f^* = \mathcal{O}\!\left(\frac{1}{\sqrt{t}}\right)
  ```
* –î–ª—è —Å–∏–ª—å–Ω–æ –≤—ã–ø—É–∫–ª–æ–π *f*:

  ```math
  \mathbb{E}[f(x_t)] - f^* = \mathcal{O}\!\left(\frac{1}{t}\right)
  ```

---

### üîπ Frank‚ÄìWolfe (FW)

```math
s_t = \arg\min_{s \in \mathcal{C}} \langle \nabla f(x_t), s \rangle, 
\qquad
x_{t+1} = (1 - \gamma_t)x_t + \gamma_t s_t
```

**–°—Ö–æ–¥–∏–º–æ—Å—Ç—å:**

* –î–ª—è —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–ª—É—á–∞—è:

  ```math
  \mathbb{E}[f(x_t)] - f^* = \mathcal{O}\!\left(\frac{1}{\sqrt{t}}\right)
  ```
* –î–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ (–ø–æ–ª–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç):

  ```math
  f(x_t) - f^* = \mathcal{O}\!\left(\frac{1}{t}\right)
  ```

---

### üîπ N-Conjugate Frank‚ÄìWolfe (NFW)

```math
d_t = \sum_{i=t-N}^{t} w_i (s_i - x_i),
\qquad
x_{t+1} = x_t + \gamma_t d_t
```

–ú–µ—Ç–æ–¥ —Ö—Ä–∞–Ω–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ (N) –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏ –∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏,
—á—Ç–æ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –∫—Ä–∏–≤–∏–∑–Ω—É –∑–∞–¥–∞—á–∏ ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ BFGS.
–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **—É—Å–∫–æ—Ä–µ–Ω–Ω—É—é –∏ –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å**,
–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —à—É–º–∞ –≤ —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∏—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞—Ö.

---

| –°–≤–æ–π—Å—Ç–≤–æ               | Projected Gradient (SGD) | Frank‚ÄìWolfe (SGD)   | N-Conjugate FW (SGD)   |
| ---------------------- | ------------------------ | ------------------- | ---------------------- |
| –¢–∏–ø –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞          | —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∏–π           | —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∏–π      | —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∏–π         |
| –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–µ–∫—Ü–∏–∏       | ‚úÖ                        | ‚ùå                   | ‚ùå                      |
| –°—Ç–æ–∏–º–æ—Å—Ç—å —à–∞–≥–∞         | –≤—ã—Å–æ–∫–∞—è                  | –Ω–∏–∑–∫–∞—è              | —É–º–µ—Ä–µ–Ω–Ω–∞—è              |
| –°—Ö–æ–¥–∏–º–æ—Å—Ç—å (–≤ —Å—Ä–µ–¥–Ω–µ–º) | ùí™(1/‚àöt)                 | ùí™(1/‚àöt)            | –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ    |
| –†–µ—à–µ–Ω–∏—è                | –ø–ª–æ—Ç–Ω—ã–µ                  | —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã–µ         | —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—ã–µ            |
| –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ            | —Å—Ç–∞–±–∏–ª—å–Ω–∞—è               | –ø–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ | —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ |

---

üìò *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:*
–°—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–æ–π –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å –≤ —Ä–∞–±–æ—Ç–∞—Ö
**Hazan & Luo (2016)** –∏ **Reddi et al. (2020)** –¥–ª—è FW –∏ PGD,
–∞ N-Conjugate FW **Ignashin I (2024)** –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä—Å–∏—è FW —Å –ø–∞–º—è—Ç—å—é
(–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ momentum –∏–ª–∏ quasi-Newton).


## üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é

```python
from constraint_optimization.models import SmallCNN
from constraint_optimization.sets import L1ConstraintSet
from constraint_optimization.optim import FrankWolfe

model = SmallCNN()
tau = {name: 5.0 for name, _ in model.named_parameters()}
constraint = L1ConstraintSet(model, tau)

optimizer = FrankWolfe(
    [{"params": model.parameters(),
      "params_dict": dict(model.named_parameters())}],
    constraint, lr=0.05
)
```

---

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞:

```python
class L2ConstraintSet(ConstraintSet):
    def lmo(self, grad_dict):
        ...
    def project(self, param_dict):
        ...
```

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞:

```python
class MyOptimizer(torch.optim.Optimizer):
    def step(self, closure):
        ...
```

---

## üìö –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞

* Jaggi, M. (2013). *Revisiting Frank-Wolfe: Projection-Free Sparse Convex Optimization*
* Lacoste-Julien, S. (2016). *Convergence rate of Frank-Wolfe for non-convex objectives*
* Beck, A. (2017). *First-Order Methods in Optimization*
* Bertsekas, D. (1999). *Nonlinear Programming*
* Ignashin, I. (2024) *Modifications of the Frank-Wolfe algorithm in the problem of finding an equilibrium distribution of traffic flows*